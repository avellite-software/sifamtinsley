{% comment %}
  V1 - Custom Product Page
  - Simplified two-column layout (45% image, 55% info).
  - Custom styling for the main info panel.
  - Dynamic tab system below for metafields (Features, Downloads, Certifications).
  - Tabs only appear if the corresponding metafield has content.
{% endcomment %}

{%- style -%}
  .product-section-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 3rem 1.5rem;
  }

  /* ==============================================
     TOP SECTION: Image & Main Info
     ============================================== */
  .product-main-container {
    display: grid;
    grid-template-columns: 45fr 55fr; /* 45% / 55% split */
    gap: 0;
    margin-bottom: 2rem;
  }

  .product-image-column img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .product-info-column {
    background-color: #f5f5f5;
    padding: 40px;
    border-bottom-left-radius: 50px; /* As requested */
    display: flex;
    flex-direction: column;
  }

  .product-info-column__vendor {
    text-transform: uppercase;
    color: #666;
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
  }

  .product-info-column__title {
    font-size: 2.5rem;
    margin: 0 0 1rem;
    line-height: 1.2;
  }

  .product-info-column .product__description {
    font-size: 1rem;
    line-height: 1.6;
    color: #333;
  }

  /* Basic form styles */
  .product-form {
    margin-top: auto; /* Pushes form to the bottom */
    padding-top: 2rem;
  }

  .product-form__submit {
    width: 100%;
    padding: 15px 20px;
    background: #c1151b;
    color: #fff;
    border: 1px solid #c1151b;
    border-radius: 4px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .product-form__submit:hover {
    background-color: #a10f16;
  }
  .product-form__submit[disabled] {
    background-color: #ccc;
    border-color: #ccc;
    cursor: not-allowed;
  }

  /* ==============================================
     BOTTOM SECTION: Tabs for Metafields
     ============================================== */
  .product-tabs-container {
    background-color: #fff;
    border: 1px solid #e5e5e5;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    border-radius: 0 50px 50px 50px; /* As requested */
    position: relative;
  }

  .product-tabs-nav {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    position: absolute;
    top: -45px; /* Pulls tabs up to sit on the top border */
    left: 0;
  }

  .product-tabs-nav__item {
    background-color: #f0f0f0;
    color: #333;
    padding: 12px 25px;
    cursor: pointer;
    border: 1px solid #e5e5e5;
    border-bottom: none;
    border-radius: 4px 4px 0 0;
    margin-right: 5px;
    font-weight: 600;
    transition: background-color 0.2s ease;
  }

  .product-tabs-nav__item:hover {
    background-color: #e0e0e0;
  }

  .product-tabs-nav__item.is-active {
    background-color: #fff;
    border-bottom: 1px solid #fff;
    position: relative;
    top: 1px;
  }

  .product-tabs-content {
    padding: 60px 40px 40px;
  }

  .product-tabs-content__panel {
    display: none; /* Hide all panels by default */
  }

  .product-tabs-content__panel.is-active {
    display: block; /* Show only the active one */
  }

  /* Styling for downloads/certifications lists */
  .product-file-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .product-file-list li {
    margin-bottom: 0.75rem;
  }
  .product-file-list a {
    text-decoration: none;
    color: #c1151b;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .product-file-list a:hover {
    text-decoration: underline;
  }

  /* Mobile responsiveness */
  @media screen and (max-width: 768px) {
    .product-main-container {
      grid-template-columns: 1fr;
    }
    .product-info-column {
      border-radius: 0 0 50px 50px;
    }
    .product-tabs-container {
      border-radius: 50px;
    }
    .product-tabs-nav {
      position: static;
      flex-wrap: wrap;
      border-bottom: 1px solid #e5e5e5;
    }
    .product-tabs-nav__item {
      border-radius: 0;
      border: none;
      flex-grow: 1;
      text-align: center;
    }
    .product-tabs-nav__item.is-active {
      background-color: #f0f0f0;
      border-bottom: 2px solid #c1151b;
      top: 0;
    }
    .product-tabs-content {
      padding: 30px 20px;
    }
  }
{%- endstyle -%}

{%- liquid
  assign features_content = product.metafields.custom.features.value
  assign downloads_content = product.metafields.custom.downloads.value
  assign certifications_content = product.metafields.custom.certifications.value
-%}

<section class="product-section-wrapper color-{{ section.settings.color_scheme }}">
  <div class="product-main-container">
    <div class="product-image-column">
      {%- if product.featured_image -%}
        <img
          src="{{ product.featured_image | image_url: width: 1024 }}"
          alt="{{ product.featured_image.alt | escape }}"
          width="{{ product.featured_image.width }}"
          height="{{ product.featured_image.height }}"
          loading="eager"
        >
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}
    </div>
    <div class="product-info-column">
      <p class="product-info-column__vendor">{{ product.vendor }}</p>
      <h1 class="product-info-column__title">{{ product.title }}</h1>

      {%- if product.description != blank -%}
        <div class="product__description rte">
          {{ product.description }}
        </div>
      {%- endif -%}

      {%- form 'product',
        product,
        id: 'main-product-form',
        class: 'form product-form',
        novalidate: 'novalidate',
        data-type: 'add-to-cart-form'
      -%}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

        {%- unless product.has_only_default_variant -%}
          {%- render 'product-variant-picker', product: product, form: form, section: section -%}
        {%- endunless -%}

        <div class="product-form__buttons">
          <button
            type="submit"
            name="add"
            class="product-form__submit button button--full-width button--primary"
            {% if product.selected_or_first_available_variant.available == false %}
              disabled
            {% endif %}
          >
            <span>
              {%- if product.selected_or_first_available_variant.available -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- else -%}
                {{ 'products.product.sold_out' | t }}
              {%- endif -%}
            </span>
          </button>
        </div>
      {%- endform -%}
    </div>
  </div>

  {%- if features_content != blank or downloads_content != blank or certifications_content != blank -%}
    <div class="product-tabs-container">
      <ul class="product-tabs-nav" role="tablist">
        {%- if features_content != blank -%}
          <li class="product-tabs-nav__item" data-tab="features" role="tab">Features</li>
        {%- endif -%}
        {%- if downloads_content != blank -%}
          <li class="product-tabs-nav__item" data-tab="downloads" role="tab">Downloads</li>
        {%- endif -%}
        {%- if certifications_content != blank -%}
          <li class="product-tabs-nav__item" data-tab="certifications" role="tab">Certifications</li>
        {%- endif -%}
      </ul>
      <div class="product-tabs-content">
        {%- if features_content != blank -%}
          <div class="product-tabs-content__panel rte" data-content="features" role="tabpanel">
            {{ features_content }}
          </div>
        {%- endif -%}
        {%- if downloads_content != blank -%}
          <div class="product-tabs-content__panel" data-content="downloads" role="tabpanel">
            <ul class="product-file-list">
              {%- for file in downloads_content -%}
                <li>
                  <a href="{{ file | file_url }}" download target="_blank">{{ file.alt | default: 'Download File' }}</a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        {%- endif -%}
        {%- if certifications_content != blank -%}
          <div class="product-tabs-content__panel" data-content="certifications" role="tabpanel">
            <ul class="product-file-list">
              {%- for file in certifications_content -%}
                <li>
                  <a href="{{ file | file_url }}" download target="_blank">
                    {{- file.alt | default: 'Download Certificate' -}}
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        {%- endif -%}
      </div>
    </div>
  {%- endif -%}
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabsContainer = document.querySelector('.product-tabs-container');
    if (tabsContainer) {
      const tabs = tabsContainer.querySelectorAll('.product-tabs-nav__item');
      const contentPanels = tabsContainer.querySelectorAll('.product-tabs-content__panel');

      // Set the first tab as active by default
      const firstTab = tabs[0];
      if (firstTab) {
        const firstContentId = firstTab.getAttribute('data-tab');
        const firstContentPanel = tabsContainer.querySelector(`[data-content="${firstContentId}"]`);

        firstTab.classList.add('is-active');
        if (firstContentPanel) firstContentPanel.classList.add('is-active');
      }

      tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');

          // Deactivate all tabs and panels
          tabs.forEach((item) => item.classList.remove('is-active'));
          contentPanels.forEach((panel) => panel.classList.remove('is-active'));

          // Activate the clicked tab and its corresponding panel
          tab.classList.add('is-active');
          const activePanel = tabsContainer.querySelector(`[data-content="${tabId}"]`);
          if (activePanel) {
            activePanel.classList.add('is-active');
          }
        });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    }
  ]
}
{% endschema %}
