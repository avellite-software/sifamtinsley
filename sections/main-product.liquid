{% comment %}
  V4 - Custom Product Page
  - Support box button now uses a `mailto:` link.
  - Schema updated to accept an email address instead of a URL.
{% endcomment %}

{%- style -%}
  /* The main section now acts as an overflow container for the full-bleed element */
  .product-page-section {
    overflow-x: hidden;
  }

  .product-section-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* ==============================================
     TOP SECTION: Image & Main Info
     ============================================== */
  .product-main-container {
    display: grid;
    grid-template-columns: 45fr 55fr;
    gap: 0;
    margin-top: 3rem;
    margin-bottom: 4rem;
  }

  .product-image-column img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .product-info-column {
    padding: 40px;
    display: flex;
    flex-direction: column;
    position: relative;
  }

  /* This pseudo-element creates the full-bleed background */
  .product-info-column::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: -1;
    background-color: #f5f5f5;
    border-bottom-left-radius: 50px;
    width: 100vw; /* Extends far to the right */
  }

  .product-info-column__vendor {
    text-transform: uppercase;
    color: #666;
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
  }

  .product-info-column__title {
    font-size: 2.8rem;
    margin: 0 0 1rem;
    line-height: 1.2;
  }

  .product-info-column .product__description {
    font-size: 1.1rem;
    line-height: 1.7;
    color: #333;
    flex-grow: 1;
  }

  /* ==============================================
     SUPPORT BOX STYLES (Integrated)
     ============================================== */
  .support-box-wrapper {
    margin-top: auto;
    padding-top: 2rem;
  }
  .support-box {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    text-align: center;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .support-box-content {
    padding: 40px 40px 30px;
    flex-grow: 1;
  }
  .support-box-heading {
    font-size: 32px;
    font-weight: 800;
    color: #1c1c1c;
    margin: 0 0 15px;
  }
  .support-box-subheading {
    font-size: 16px;
    line-height: 1.6;
    color: #555;
    margin: 0 0 30px;
  }
  .support-box-phone {
    font-size: 20px;
    font-weight: 600;
    color: #333;
    margin: 0;
    display: block;
  }
  .support-box-button {
    display: block;
    background-color: #c1151b;
    color: #fff;
    text-decoration: none;
    font-size: 18px;
    font-weight: 600;
    padding: 15px 20px;
    transition: background-color 0.2s;
    border-radius: 0 0 12px 12px;
  }
  .support-box-button:hover {
    background-color: #a10f16;
  }

  /* ==============================================
     BOTTOM SECTION: Tabs for Metafields
     ============================================== */
  .product-tabs-wrapper {
    padding-bottom: 3rem;
  }
  .product-tabs-container {
    background-color: #fff;
    border: 1px solid #e5e5e5;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    border-radius: 0 50px 50px 50px;
    position: relative;
  }
  .product-tabs-nav {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    position: absolute;
    top: -55px;
    left: -1px;
  }
  .product-tabs-nav__item {
    background-color: #f0f0f0;
    color: #333;
    padding: 12px 25px;
    cursor: pointer;
    border: 1px solid #e5e5e5;
    border-bottom: none;
    border-radius: 4px 4px 0 0;
    margin-right: 5px;
    font-weight: 600;
    transition: background-color 0.2s ease;
  }
  .product-tabs-nav__item:hover {
    background-color: #e0e0e0;
  }
  .product-tabs-nav__item.is-active {
    background-color: #fff;
    border-bottom: 1px solid #fff;
    position: relative;
    top: 1px;
  }
  .product-tabs-content {
    padding: 60px 40px 40px;
  }
  .product-tabs-content__panel {
    display: none;
  }
  .product-tabs-content__panel.is-active {
    display: block;
  }
  .product-tabs-content__panel.rte p {
    margin: 0 0 1em;
  }
  .product-tabs-content__panel.rte ul,
  .product-tabs-content__panel.rte ol {
    margin: 1em 0;
    padding-left: 1.5em;
  }
  .product-tabs-content__panel.rte li {
    margin-bottom: 0.5em;
  }
  .product-file-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .product-file-list li {
    margin-bottom: 0.75rem;
  }
  .product-file-list a {
    text-decoration: none;
    color: #c1151b;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .product-file-list a:hover {
    text-decoration: underline;
  }

  /* Mobile responsiveness */
  @media screen and (max-width: 768px) {
    .product-main-container {
      grid-template-columns: 1fr;
    }
    .product-info-column {
      border-radius: 0;
    }
    .product-info-column::before {
      border-bottom-left-radius: 50px;
      border-bottom-right-radius: 50px;
    }
    .product-tabs-container {
      border-radius: 50px;
    }
    .product-tabs-nav {
      position: static;
      flex-wrap: wrap;
      border-bottom: 1px solid #e5e5e5;
    }
    .product-tabs-nav__item {
      border-radius: 0;
      border: none;
      flex-grow: 1;
      text-align: center;
    }
    .product-tabs-nav__item.is-active {
      background-color: #f0f0f0;
      border-bottom: 2px solid #c1151b;
      top: 0;
    }
    .product-tabs-content {
      padding: 30px 20px;
    }
  }
{%- endstyle -%}

{%- liquid
  assign features_content = product.metafields.custom.features.value
  assign downloads_content = product.metafields.custom.downloads.value
  assign certifications_content = product.metafields.custom.certifications.value
-%}

<section class="color-{{ section.settings.color_scheme }} product-page-section">
  <div class="product-section-wrapper">
    <div class="product-main-container">
      <div class="product-image-column">
        {%- if product.featured_image -%}
          <img
            src="{{ product.featured_image | image_url: width: 1024 }}"
            alt="{{ product.featured_image.alt | escape }}"
            width="{{ product.featured_image.width }}"
            height="{{ product.featured_image.height }}"
            loading="eager"
          >
        {%- else -%}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </div>
      <div class="product-info-column">
        <p class="product-info-column__vendor">{{ product.vendor }}</p>
        <h1 class="product-info-column__title">{{ product.title }}</h1>

        {%- if product.description != blank -%}
          <div class="product__description rte">
            {{ product.description }}
          </div>
        {%- endif -%}

        <div class="support-box-wrapper">
          <div class="support-box">
            <div class="support-box-content">
              <h2 class="support-box-heading">{{ section.settings.box_heading }}</h2>
              <p class="support-box-subheading">{{ section.settings.box_subheading }}</p>
              <span class="support-box-phone">{{ section.settings.box_phone }}</span>
            </div>

            {% if section.settings.button_label != blank and section.settings.button_email != blank %}
              <a href="mailto:{{ section.settings.button_email }}" class="support-box-button">
                {{ section.settings.button_label }}
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="product-section-wrapper product-tabs-wrapper">
    {%- if features_content != blank or downloads_content != blank or certifications_content != blank -%}
      <div class="product-tabs-container">
        <ul class="product-tabs-nav" role="tablist">
          {%- if features_content != blank -%}
            <li class="product-tabs-nav__item" data-tab="features" role="tab">Features</li>
          {%- endif -%}
          {%- if downloads_content != blank -%}
            <li class="product-tabs-nav__item" data-tab="downloads" role="tab">Downloads</li>
          {%- endif -%}
          {%- if certifications_content != blank -%}
            <li class="product-tabs-nav__item" data-tab="certifications" role="tab">Certifications</li>
          {%- endif -%}
        </ul>
        <div class="product-tabs-content">
          {%- if features_content != blank -%}
            <div class="product-tabs-content__panel rte" data-content="features" role="tabpanel">
              {{ features_content }}
            </div>
          {%- endif -%}
          {%- if downloads_content != blank -%}
            <div class="product-tabs-content__panel" data-content="downloads" role="tabpanel">
              <ul class="product-file-list">
                {%- for file in downloads_content -%}
                  <li>
                    <a href="{{ file | file_url }}" download target="_blank">
                      {{- file.alt | default: 'Download File' -}}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
          {%- if certifications_content != blank -%}
            <div class="product-tabs-content__panel" data-content="certifications" role="tabpanel">
              <ul class="product-file-list">
                {%- for file in certifications_content -%}
                  <li>
                    <a href="{{ file | file_url }}" download target="_blank">
                      {{- file.alt | default: 'Download Certificate' -}}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabsContainer = document.querySelector('.product-tabs-container');
    if (tabsContainer) {
      const tabs = tabsContainer.querySelectorAll('.product-tabs-nav__item');
      const contentPanels = tabsContainer.querySelectorAll('.product-tabs-content__panel');

      const firstTab = tabs[0];
      if (firstTab) {
        const firstContentId = firstTab.getAttribute('data-tab');
        const firstContentPanel = tabsContainer.querySelector(`[data-content="${firstContentId}"]`);

        firstTab.classList.add('is-active');
        if (firstContentPanel) firstContentPanel.classList.add('is-active');
      }

      tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          tabs.forEach((item) => item.classList.remove('is-active'));
          contentPanels.forEach((panel) => panel.classList.remove('is-active'));
          tab.classList.add('is-active');
          const activePanel = tabsContainer.querySelector(`[data-content="${tabId}"]`);
          if (activePanel) {
            activePanel.classList.add('is-active');
          }
        });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Support Box Content"
    },
    {
      "type": "text",
      "id": "box_heading",
      "label": "Heading",
      "default": "Sales & Support"
    },
    {
      "type": "text",
      "id": "box_subheading",
      "label": "Subheading",
      "default": "A dedicated support team to support new purchases, technical queries, troubleshooting, and delivery information."
    },
    {
      "type": "text",
      "id": "box_phone",
      "label": "Phone Number",
      "default": "Call 01376 335271"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Email Support"
    },
    {
      "type": "text",
      "id": "button_email",
      "label": "Button Email Address",
      "info": "Enter the email address for the support button."
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    }
  ]
}
{% endschema %}
