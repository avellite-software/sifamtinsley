{% comment %}
  Section: Main Search
  - V2: Added image support for Pages and descriptions for Products.
{% endcomment %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  .search-page-header {
    text-align: center;
    margin-bottom: 3rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .search-page-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: #1c1c1c;
  }

  /* --- Search Bar Styling (Matching Header) --- */
  .search-form-container {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
  }

  .search-form {
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 600px;
  }

  .search-input {
    flex: 1;
    padding: 12px 20px;
    background: #f3f3f3;
    border: 1px solid transparent;
    border-radius: 4px 0 0 4px;
    font-size: 16px;
    color: #333;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-input:focus {
    border-color: #ccc;
  }

  .search-btn {
    background: #fff; /* White background to match header style */
    border: 1px solid #f3f3f3; /* Subtle border to match input bg */
    border-left: none;
    border-radius: 0 4px 4px 0;
    font-size: 16px;
    color: #c1151b; /* Brand red */
    font-weight: 600;
    padding: 12px 24px;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .search-btn:hover {
    background: #eaeaea;
    color: #a10f16;
  }
  .search-btn-icon {
    width: 1.2em;
    height: 1.2em;
    fill: currentColor;
  }

  /* --- Results Grid --- */
  .search-results-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* Mobile default: 2 columns */
    gap: 20px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  @media screen and (min-width: 750px) {
    .search-results-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
    }
  }

  @media screen and (min-width: 990px) {
    .search-results-grid {
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    }
  }

  @media screen and (max-width: 600px) {
    .search-results-grid {
      grid-template-columns: 1fr; /* 1 column on very small screens */
    }
  }

  /* --- Result Card Styling --- */
  .search-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    text-decoration: none;
    color: inherit;
  }

  .search-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }

  .search-card__image-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* Square aspect ratio */
    background-color: #f9f9f9;
    overflow: hidden;
  }

  .search-card__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain; /* Keep product images contained */
    padding: 10px;
    transition: transform 0.3s ease;
  }

  .search-card:hover .search-card__image {
    transform: scale(1.05);
  }

  .search-card__content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .search-card__badge {
    display: inline-block;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 700;
    color: #777;
    margin-bottom: 0.5rem;
  }

  .search-card__title {
    font-size: 1.9rem;
    font-weight: 700;
    margin: 0 0 0.5rem;
    line-height: 1.4;
    color: #1c1c1c;
  }

  .search-card__vendor {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 0.5rem;
  }

  .search-card__price {
    font-size: 1rem;
    font-weight: 600;
    color: #c1151b;
    /* removed margin-top: auto so description can sit below */
  }

  .search-card__excerpt {
    font-size: 1.2rem;
    line-height: 1.5;
    color: #555;
    margin-top: 0.5rem;
  }

  .search-empty-message {
    text-align: center;
    padding: 4rem 0;
    color: #555;
    font-size: 1.2rem;
  }

  /* Pagination */
  .pagination-wrapper {
    margin-top: 4rem;
    display: flex;
    justify-content: center;
  }
{%- endstyle -%}

{% paginate search.results by 24 %}
  <div class="section-{{ section.id }}-padding page-width">
    {% comment %} --- Search Header & Input --- {% endcomment %}
    <div class="search-page-header">
      <h1 class="search-page-title">
        {%- if search.performed -%}
          Search Results for "{{ search.terms | escape }}"
        {%- else -%}
          Search Our Store
        {%- endif -%}
      </h1>

      <div class="search-form-container">
        <form action="{{ routes.search_url }}" method="get" role="search" class="search-form">
          <input
            class="search-input"
            type="search"
            name="q"
            value="{{ search.terms | escape }}"
            placeholder="Search products, pages, and more..."
          >
          <input name="options[prefix]" type="hidden" value="last">
          <button type="submit" class="search-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="search-btn-icon">
              <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
            </svg>
            <span class="visually-hidden">Search</span>
          </button>
        </form>
      </div>
    </div>

    {% comment %} --- Search Results --- {% endcomment %}
    {%- if search.performed -%}
      {%- if search.results_count == 0 -%}
        <div class="search-empty-message">
          <p>No results found for "{{ search.terms | escape }}". Check your spelling or try a different keyword.</p>
        </div>
      {%- else -%}
        <ul class="search-results-grid" role="list">
          {%- for item in search.results -%}
            <li>
              <a href="{{ item.url }}" class="search-card">
                {% comment %} Image Logic (Products & Articles & Pages) {% endcomment %}
                {%- if item.object_type == 'product' or item.object_type == 'article' -%}
                  <div class="search-card__image-wrapper">
                    {%- if item.featured_image -%}
                      {{
                        item.featured_image
                        | image_url: width: 600
                        | image_tag: class: 'search-card__image', loading: 'lazy'
                      }}
                    {%- elsif item.image -%}
                      {{ item.image | image_url: width: 600 | image_tag: class: 'search-card__image', loading: 'lazy' }}
                    {%- else -%}
                      <img
                        src="https://cdn.shopify.com/s/files/1/0949/2745/4595/files/sifam_tinsley_instrumentation_limited_logo.jpg?v=1759850304"
                        class="search-card__image"
                        alt="No image available"
                        width="300"
                        height="300"
                      >
                    {%- endif -%}
                  </div>

                  {% comment %} ADDED: Logic for Pages to show the Logo image {% endcomment %}
                {%- elsif item.object_type == 'page' -%}
                  <div class="search-card__image-wrapper">
                    <img
                      src="https://cdn.shopify.com/s/files/1/0949/2745/4595/files/sifam_tinsley_instrumentation_limited_logo.jpg?v=1759850304"
                      class="search-card__image"
                      alt="Sifam Tinsley"
                      loading="lazy"
                      width="300"
                      height="300"
                    >
                  </div>
                {%- endif -%}

                <div class="search-card__content">
                  <span class="search-card__badge">{{ item.object_type }}</span>
                  <h3 class="search-card__title">{{ item.title }}</h3>

                  {%- if item.object_type == 'product' -%}
                    {%- if section.settings.show_vendor -%}
                      <div class="search-card__vendor">{{ item.vendor }}</div>
                    {%- endif -%}
                    <div class="search-card__price">
                      {%- if item.compare_at_price > item.price -%}
                        <span style="text-decoration: line-through; color: #777; margin-right: 5px;">
                          {{- item.compare_at_price | money -}}
                        </span>
                      {%- endif -%}
                      {{ item.price | money }}
                    </div>
                    {% comment %} ADDED: Product Description {% endcomment %}
                    <div class="search-card__excerpt">
                      {{ item.content | strip_html | truncate: 80 }}
                    </div>

                  {%- elsif item.object_type == 'article' -%}
                    <div class="search-card__vendor">{{ item.published_at | date: format: 'abbreviated_date' }}</div>
                    <div class="search-card__excerpt">{{ item.excerpt_or_content | strip_html | truncate: 100 }}</div>

                  {%- elsif item.object_type == 'page' -%}
                    <div class="search-card__excerpt">{{ item.content | strip_html | truncate: 120 }}</div>
                  {%- endif -%}
                </div>
              </a>
            </li>
          {%- endfor -%}
        </ul>

        {%- if paginate.pages > 1 -%}
          {% render 'pagination', paginate: paginate %}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}
  </div>
{% endpaginate %}

{% schema %}
{
  "name": "Search Page",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Desktop columns"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show product vendor"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ]
}
{% endschema %}
